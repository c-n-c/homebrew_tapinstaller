format_version: 3
pipelines:
  build_formula_hellotap:
    group: sample
    label_template: ${COUNT}
    lock_behavior: none
    display_order: -1
    materials:
      git:
        git: https://github.com/c-n-c/homebrew_tapinstaller.git
        shallow_clone: true
        auto_update: true
        branch: master
    stages:
    - default_stage:
        environment_variables:
          ARTIFACTORY: 10.1.5.86
        secure_variables:
          GITUSR: AES:4dUpg629SixrCLTGt5uOPw==:3KlNE8Iva0VUdj/qc/15HA==
          GITPWD: AES:CybIMbbiqzaYgu3g892Y1w==:ZO3nQzwAdC/2KKwPnGZC6g==
          ARTUSR: AES:ZAo4Jxsla3LJkrn8OV/VwQ==:pW8z9nvc47a+zDlAmQ405w==
          ARTPWD: AES:MdBgc8rolj+fA1j3rIm8uw==:k8c3DzRbX32wrMAVT1M9Rw==
        fetch_materials: true
        keep_artifacts: false
        clean_workspace: false
        approval:
          type: success
          allow_only_on_success: false
        jobs:
          default_job:
            timeout: 0
            elastic_profile_id: demo-app
            tasks:
            - exec:
                working_directory: hellotap
                command: make
                arguments:
                - "zip"
            - exec:
                working_directory: hellotap
                command: make
                arguments:
                - "upload_zip"
            - exec:
                working_directory: hellotap
                command: make
                arguments:
                - "generate_formula"
                - VERSION=${COUNT}
            - exec:
                working_directory: hellotap
                command: make
                arguments:
                - "upload_formula"

